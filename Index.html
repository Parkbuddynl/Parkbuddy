<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ParkBuddy Heatmap</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
        width: 100%;
      }
    </style>

    <!-- Google Maps JavaScript API + Visualization library -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBAfOkNSl8Wg167g_RiADgW8mmGY78oMHs&libraries=visualization"></script>

    <!-- Firebase App (Core) -->
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js"></script>
  </head>
  <body>
    <div id="map">Loading heatmap...</div>

    <script>
      // üî• Firebase Configuratie
      const firebaseConfig = {
        apiKey: "AIzaSyBnkd-1tvBDPC4UysDzyGC6BJ-lQj2bWYY",
        authDomain: "parkbuddy-ab716.firebaseapp.com",
        projectId: "parkbuddy-ab716",
        storageBucket: "parkbuddy-ab716.firebasestorage.app",
        messagingSenderId: "757948191602",
        appId: "1:757948191602:web:fe103191635916841343eb"
      };

      const app = firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore(app);

      // üåç Google Maps en Heatmap weergeven
      let map, heatmap;

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 52.3676, lng: 4.9041 },
          zoom: 13,
          mapTypeId: "roadmap"
        });

        // üî• Haal meldingen uit Firestore
        db.collection("meldingen").get().then((querySnapshot) => {
          const heatmapData = [];

          querySnapshot.forEach((doc) => {
            const data = doc.data();
            if (data.lat && data.lng) {
              heatmapData.push(new google.maps.LatLng(data.lat, data.lng));
            }
          });

          heatmap = new google.maps.visualization.HeatmapLayer({
            data: heatmapData,
            radius: 25
          });

          heatmap.setMap(map);
        }).catch((error) => {
          console.error("‚ùå Fout bij ophalen meldingen:", error);
        });
      }

      window.initMap = initMap;
    </script>

    <!-- Start Google Maps -->
    <script>
      // Zorg dat initMap wordt aangeroepen zodra Google Maps geladen is
      if (typeof google !== "undefined") {
        initMap();
      }
    </script>
  </body>
</html>
